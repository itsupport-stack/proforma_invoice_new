<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proforma Invoice</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px;
            color: #333;
        }
        address { font-style: normal; }
        [contenteditable="true"] {
            display: inline-block; min-width: 50px; border-bottom: 1px dashed #c1d6e1;
            padding: 2px; outline: none; cursor: text; transition: all 0.2s;
        }
        [contenteditable="true"]:hover, [contenteditable="true"]:focus { border-bottom-color: #0a5e5e; background-color: #f0f8ff; }
        input, select {
            border: 1px solid #c1d6e1; padding: 2px 4px; border-radius: 4px; outline: none;
            transition: all 0.2s;
        }
        input:hover, select:hover, input:focus, select:focus { border-color: #0a5e5e; background-color: #f0f8ff; }

        /* Hide default dropdown arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%230a5e5e" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }

        /* Message box styling */
        .message-box {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background-color: #004343; color: white; padding: 1rem 2rem; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); z-index: 1000; display: none;
            animation: fadeInOut 3s forwards; font-weight: 500;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateX(-50%) scale(0.9); }
            10%, 90% { opacity: 1; transform: translateX(-50%) scale(1); }
        }

        /* A4 Paper Optimization for printing */
        .invoice-container {
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            margin: 0 auto;
            padding: 20mm;
            box-shadow: none;
        }
        .invoice-container, body { background-color: #ffffff; }

        /* Fix for state dropdown overflow */
        .address-select {
            max-width: calc(100% - 70px); /* Adjust based on label width */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Enforce a page break before the terms and conditions section */
        #terms-and-footer-page {
            page-break-before: always;
            padding-top: 20mm; /* Adjust padding for a clean start on the new page */
            position: relative;
        }

        @media print {
            @page {
                size: A4;
                margin: 10mm;
            }
            body {
                margin: 0;
                font-size: 12px;
                color: #000;
            }
            .invoice-container {
                width: 100%;
                min-height: 0;
                padding: 0;
                box-shadow: none;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print, .add-remove-buttons { display: none !important; }
            .print-hide-if-empty.hidden-for-print { display: none !important; }
            [contenteditable="true"], input, select { border: none !important; background-color: transparent !important; padding: 0; }
            .delete-item-btn { display: none; }

            /* Hide dropdown arrows in print */
            select {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-image: none;
            }
            /* Adjust input and span padding for print */
            .customer-info p > span, .customer-info input { padding: 0 !important; }

            /* Keep table header on every page */
            table { page-break-after: auto; }
            thead { display: table-header-group; }

            /* Prevent rows and footer from splitting across pages */
            tr, tfoot, .footer-content { page-break-inside: avoid; }

            /* Fix QR code print size */
            #qrcode { display: block !important; }
            #qrcode img {
                width: 100px !important;
                height: 100px !important;
            }

            /* Ensure the footer section is full-page on print */
            #terms-and-footer-page {
                height: auto;
                padding-top: 10mm;
                padding-bottom: 10mm;
            }
            #thank-you-message-print {
                display: block !important;
            }

            /* Vertically shorten the green border in print */
            .bank-details-block, .terms-block {
                height: auto; /* Allow height to be determined by content */
                display: flex;
                flex-direction: column;
            }
            .bank-details-content, .terms-content {
                flex-grow: 1; /* Allow content to grow, but border stays with content */
                border-left-width: 4px;
                border-color: #009a7b;
            }
            /* Remove margins that cause extra spacing */
            .bank-details-block, .terms-block {
                margin-bottom: 0 !important;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#004343',
                        'secondary-dark': '#0a5e5e',
                        'primary-accent': '#009a7b',
                        'secondary-accent': '#11c99d',
                        'white-shade': '#ffffff',
                    },
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-4">

    <div class="message-box" id="message-box"></div>

    <div class="invoice-container bg-white shadow-lg mx-auto">
        <header class="flex justify-between items-start mb-10">
            <div class="w-2/5">
                <img src="https://raw.githubusercontent.com/ganesh-gn/proforma-invoice/main/logo-placeholder.png" alt="Company Logo" class="w-32 mb-4" id="company-logo">
                <h1 class="text-3xl font-bold text-primary-dark" contenteditable="true">YOUR COMPANY</h1>
                <p contenteditable="true">123 Business Avenue, Suite 100, City, State, 500082</p>
                <p><strong>GSTIN:</strong> <span contenteditable="true">29AAAAA0000A1Z5</span></p>
            </div>
            <div class="text-right">
                <h2 class="text-4xl font-bold text-primary-accent">PROFORMA INVOICE</h2>
                <p class="mt-2"><strong>Invoice #:</strong> <span contenteditable="true">PRO-2024-001</span></p>
                <p><strong>Date:</strong> <span id="invoice-date"></span></p>
            </div>
        </header>

        <section class="customer-info grid grid-cols-2 gap-10 mb-10">
            <div>
                <h3 class="font-bold text-lg text-primary-dark mb-2">Bill To:</h3>
                <p><span contenteditable="true" class="font-semibold">Customer Name</span></p>
                <address contenteditable="true">
                    123 Client Street<br>
                    Client City, State, 500032
                </address>
                <p><strong>GSTIN:</strong> <span contenteditable="true">27AAAAA0000A1Z5</span></p>
                <p><strong>State:</strong>
                    <select class="address-select" onchange="updateStateCode(this, 'billing-state-code')">
                        <option value="">Select State</option>
                    </select>
                    (<span id="billing-state-code"></span>)
                </p>
            </div>
            <div class="text-right">
                <h3 class="font-bold text-lg text-primary-dark mb-2">Ship To:</h3>
                <p><span contenteditable="true" class="font-semibold">Recipient Name</span></p>
                <address contenteditable="true">
                    456 Recipient Drive<br>
                    Recipient City, State, 500084
                </address>
                 <p><strong>State:</strong>
                    <select class="address-select" onchange="updateStateCode(this, 'shipping-state-code')">
                        <option value="">Select State</option>
                    </select>
                    (<span id="shipping-state-code"></span>)
                </p>
            </div>
        </section>

        <section>
            <table class="w-full text-left table-auto border-collapse">
                <thead>
                    <tr class="bg-primary-dark text-white">
                        <th class="p-3">#</th>
                        <th class="p-3 w-2/5">Particulars</th>
                        <th class="p-3">HSN/SAC</th>
                        <th class="p-3">Qty</th>
                        <th class="p-3">Rate</th>
                        <th class="p-3">Amount</th>
                        <th class="no-print p-3"></th>
                    </tr>
                </thead>
                <tbody id="invoice-items">
                    </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" class="border-t-2 border-gray-200"></td>
                        <td class="p-2 border-t-2 border-gray-200 font-semibold">Subtotal</td>
                        <td id="subtotal" class="p-2 border-t-2 border-gray-200 text-right">0.00</td>
                        <td class="no-print border-t-2 border-gray-200"></td>
                    </tr>
                    <tr class="print-hide-if-empty">
                        <td colspan="4"></td>
                        <td class="p-2 font-semibold">Discount (%) <input type="number" id="discount-percent" class="w-16 ml-2" min="0" value="0"></td>
                        <td id="discount-amount" class="p-2 text-right">0.00</td>
                         <td class="no-print"></td>
                    </tr>
                    <tr class="print-hide-if-empty hidden-for-print">
                        <td colspan="4"></td>
                        <td class="p-2 font-semibold">Taxable Amount</td>
                        <td id="taxable-amount" class="p-2 text-right">0.00</td>
                         <td class="no-print"></td>
                    </tr>
                    <tr class="print-hide-if-empty">
                        <td colspan="4"></td>
                        <td class="p-2 font-semibold">CGST (%) <input type="number" id="cgst-percent" class="w-16 ml-2" min="0" value="9"></td>
                        <td id="cgst-amount" class="p-2 text-right">0.00</td>
                         <td class="no-print"></td>
                    </tr>
                    <tr class="print-hide-if-empty">
                        <td colspan="4"></td>
                        <td class="p-2 font-semibold">SGST (%) <input type="number" id="sgst-percent" class="w-16 ml-2" min="0" value="9"></td>
                        <td id="sgst-amount" class="p-2 text-right">0.00</td>
                         <td class="no-print"></td>
                    </tr>
                    <tr class="print-hide-if-empty">
                        <td colspan="4"></td>
                        <td class="p-2 font-semibold">IGST (%) <input type="number" id="igst-percent" class="w-16 ml-2" min="0" value="0"></td>
                        <td id="igst-amount" class="p-2 text-right">0.00</td>
                         <td class="no-print"></td>
                    </tr>
                     <tr class="print-hide-if-empty">
                        <td colspan="4"></td>
                        <td class="p-2 font-semibold">TCS (%) <input type="number" id="tcs-percent" class="w-16 ml-2" min="0" value="1"></td>
                        <td id="tcs-amount" class="p-2 text-right">0.00</td>
                         <td class="no-print"></td>
                    </tr>
                    <tr class="bg-gray-100">
                        <td colspan="4"></td>
                        <td class="p-3 font-bold text-primary-dark">Grand Total</td>
                        <td id="grand-total" class="p-3 text-right font-bold text-primary-dark">0.00</td>
                        <td class="no-print"></td>
                    </tr>
                </tfoot>
            </table>
            <div class="add-remove-buttons mt-4 no-print">
                <button onclick="addItem()" class="bg-primary-accent text-white px-4 py-2 rounded hover:bg-secondary-accent transition-colors">Add Item</button>
            </div>
            <p class="mt-4"><strong>Amount in words:</strong> <span id="amount-in-words" class="font-semibold"></span></p>
        </section>

        <div id="terms-and-footer-page">
            <div class="grid grid-cols-2 gap-10">
                <div class="bank-details-block">
                    <h3 class="font-bold text-lg text-primary-dark mb-2">Bank Details:</h3>
                    <div class="bank-details-content border-l-4 border-primary-accent pl-4">
                        <p><strong>Bank Name:</strong> <span contenteditable="true">Example Bank</span></p>
                        <p><strong>Account Name:</strong> <span contenteditable="true">Your Company Inc.</span></p>
                        <p><strong>Account Number:</strong> <span contenteditable="true">1234567890</span></p>
                        <p><strong>IFSC Code:</strong> <span contenteditable="true">EXBK0001234</span></p>
                        <p><strong>Branch:</strong> <span contenteditable="true">Main Branch, City</span></p>
                    </div>
                </div>

                <div class="text-center">
                    <h3 class="font-bold text-lg text-primary-dark mb-2">Scan to Pay</h3>
                    <div id="qrcode" class="flex justify-center"></div>
                </div>
            </div>

            <div class="terms-block mt-10">
                <h3 class="font-bold text-lg text-primary-dark mb-2">Terms & Conditions:</h3>
                <div class="terms-content border-l-4 border-primary-accent pl-4 text-xs">
                    <ol class="list-decimal list-inside" contenteditable="true">
                        <li>Payment: 50% advance, 50% on delivery.</li>
                        <li>Delivery: Within 14 working days of receiving the advance payment.</li>
                        <li>Validity: This proforma invoice is valid for 30 days.</li>
                        <li>Taxes: All applicable taxes are extra as per actuals.</li>
                        <li>Jurisdiction: All disputes are subject to City jurisdiction.</li>
                    </ol>
                </div>
            </div>
            
            <footer class="footer-content text-center mt-10 pt-5 border-t-2 border-primary-accent">
                <p class="font-semibold">Thank you for your business!</p>
                <p class="text-sm">This is a computer-generated proforma invoice and does not require a signature.</p>
                <div id="thank-you-message-print" class="hidden font-bold mt-4">Thank You!</div>
            </footer>
        </div>
    </div>

    <template id="item-row-template">
        <tr class="item-row border-b border-gray-200">
            <td class="p-2 item-sr"></td>
            <td class="p-2">
                <select class="w-full particulars">
                    <option>Select a product</option>
                    </select>
            </td>
            <td class="p-2"><input type="text" class="w-full hsn-sac"></td>
            <td class="p-2"><input type="number" class="w-20 qty" value="1" min="0"></td>
            <td class="p-2"><input type="number" class="w-24 rate" value="0.00" min="0"></td>
            <td class="p-2 text-right amount">0.00</td>
            <td class="no-print p-2">
                <button onclick="deleteItem(this)" class="delete-item-btn text-red-500 hover:text-red-700">&times;</button>
            </td>
        </tr>
    </template>
    
    <script>
        // State data with codes
        const states = [
            { name: "Andhra Pradesh", code: "37" }, { name: "Arunachal Pradesh", code: "12" }, { name: "Assam", code: "18" },
            { name: "Bihar", code: "10" }, { name: "Chhattisgarh", code: "22" }, { name: "Goa", code: "30" },
            { name: "Gujarat", code: "24" }, { name: "Haryana", code: "06" }, { name: "Himachal Pradesh", code: "02" },
            { name: "Jharkhand", code: "20" }, { name: "Karnataka", code: "29" }, { name: "Kerala", code: "32" },
            { name: "Madhya Pradesh", code: "23" }, { name: "Maharashtra", code: "27" }, { name: "Manipur", code: "14" },
            { name: "Meghalaya", code: "17" }, { name: "Mizoram", code: "15" }, { name: "Nagaland", code: "13" },
            { name: "Odisha", code: "21" }, { name: "Punjab", code: "03" }, { name: "Rajasthan", code: "08" },
            { name: "Sikkim", code: "11" }, { name: "Tamil Nadu", code: "33" }, { name: "Telangana", code: "36" },
            { name: "Tripura", code: "16" }, { name: "Uttar Pradesh", code: "09" }, { name: "Uttarakhand", code: "05" },
            { name: "West Bengal", code: "19" }, { name: "Andaman and Nicobar Islands", code: "35" }, { name: "Chandigarh", code: "04" },
            { name: "Dadra and Nagar Haveli and Daman and Diu", code: "26" }, { name: "Delhi", code: "07" },
            { name: "Jammu and Kashmir", code: "01" }, { name: "Ladakh", code: "38" }, { name: "Lakshadweep", code: "31" },
            { name: "Puducherry", code: "34" }
        ];

        // Function to populate state dropdowns
        function populateStates() {
            const stateDropdowns = document.querySelectorAll('.address-select');
            stateDropdowns.forEach(dropdown => {
                states.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state.code;
                    option.textContent = state.name;
                    dropdown.appendChild(option);
                });
            });
        }
        
        function updateStateCode(selectElement, codeElementId) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            document.getElementById(codeElementId).textContent = selectedOption.value || 'N/A';
            updateCalculations(); // Recalculate taxes on state change
        }

        // Function to set the current date
        function setCurrentDate() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            document.getElementById('invoice-date').textContent = `${day}/${month}/${year}`;
        }

        // Function to add a new item row
        function addItem() {
            const template = document.getElementById('item-row-template');
            const clone = template.content.cloneNode(true);
            const newRow = clone.querySelector('tr');
            document.getElementById('invoice-items').appendChild(newRow);
            updateSerialNumbers();
            attachRowEventListeners(newRow); // Attach listeners to the new row
            populateParticulars(newRow.querySelector('.particulars')); // Populate dropdown for the new row
        }

        // Function to delete an item row
        function deleteItem(button) {
            const row = button.closest('tr');
            row.remove();
            updateSerialNumbers();
            updateCalculations();
        }

        // Function to update serial numbers
        function updateSerialNumbers() {
            const rows = document.querySelectorAll('#invoice-items .item-row');
            rows.forEach((row, index) => {
                row.querySelector('.item-sr').textContent = index + 1;
            });
        }

        // Function to handle calculations
        function updateCalculations() {
            let subtotal = 0;
            const rows = document.querySelectorAll('#invoice-items .item-row');
            rows.forEach(row => {
                const qty = parseFloat(row.querySelector('.qty').value) || 0;
                const rate = parseFloat(row.querySelector('.rate').value) || 0;
                const amount = qty * rate;
                row.querySelector('.amount').textContent = amount.toFixed(2);
                subtotal += amount;
            });

            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            
            const discountPercent = parseFloat(document.getElementById('discount-percent').value) || 0;
            const discountAmount = subtotal * (discountPercent / 100);
            document.getElementById('discount-amount').textContent = `-${discountAmount.toFixed(2)}`;

            const taxableAmount = subtotal - discountAmount;
            document.getElementById('taxable-amount').textContent = taxableAmount.toFixed(2);

            // Check if billing and shipping states are the same
            const billingStateCode = document.getElementById('billing-state-code').textContent;
            const shippingStateCode = document.getElementById('shipping-state-code').textContent;
            
            let cgstAmount = 0, sgstAmount = 0, igstAmount = 0;
            
            if (billingStateCode && shippingStateCode && billingStateCode === shippingStateCode) {
                // Apply CGST & SGST
                const cgstPercent = parseFloat(document.getElementById('cgst-percent').value) || 0;
                const sgstPercent = parseFloat(document.getElementById('sgst-percent').value) || 0;
                cgstAmount = taxableAmount * (cgstPercent / 100);
                sgstAmount = taxableAmount * (sgstPercent / 100);
                document.getElementById('igst-percent').value = 0; // Reset IGST
            } else {
                // Apply IGST
                const igstPercent = parseFloat(document.getElementById('igst-percent').value) || 0;
                igstAmount = taxableAmount * (igstPercent / 100);
                document.getElementById('cgst-percent').value = 0; // Reset CGST
                document.getElementById('sgst-percent').value = 0; // Reset SGST
            }

            document.getElementById('cgst-amount').textContent = cgstAmount.toFixed(2);
            document.getElementById('sgst-amount').textContent = sgstAmount.toFixed(2);
            document.getElementById('igst-amount').textContent = igstAmount.toFixed(2);
            
            const tcsPercent = parseFloat(document.getElementById('tcs-percent').value) || 0;
            const totalTax = cgstAmount + sgstAmount + igstAmount;
            const tcsAmount = (taxableAmount + totalTax) * (tcsPercent / 100);
            document.getElementById('tcs-amount').textContent = tcsAmount.toFixed(2);

            const grandTotal = taxableAmount + totalTax + tcsAmount;
            document.getElementById('grand-total').textContent = grandTotal.toFixed(2);
            document.getElementById('amount-in-words').textContent = numberToWords(grandTotal);

            // Hide/show tax rows based on values
            toggleTaxVisibility('cgst', cgstAmount);
            toggleTaxVisibility('sgst', sgstAmount);
            toggleTaxVisibility('igst', igstAmount);
            toggleTaxVisibility('tcs', tcsAmount);
            toggleTaxVisibility('discount', discountAmount);
        }
        
        function toggleTaxVisibility(taxName, amount) {
            const row = document.getElementById(`${taxName}-amount`).closest('tr');
            if (amount === 0) {
                row.classList.add('hidden-for-print');
            } else {
                row.classList.remove('hidden-for-print');
            }
        }
        
        function attachRowEventListeners(row) {
            row.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', updateCalculations);
            });
        }
        
        // Function to convert number to words
        function numberToWords(num) {
            const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
            
            if ((num = num.toString()).length > 9) return 'overflow';
            const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return;
            let str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + ' crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + ' lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + ' thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + ' hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
            
            // Handle paise part
            const parts = num.split('.');
            if (parts.length > 1 && parseInt(parts[1]) > 0) {
                const paise = parts[1].slice(0, 2);
                str += ' and ' + numberToWords(paise) + ' paise';
            }
            
            return str.trim().split(/\s+/).map(s => s.charAt(0).toUpperCase() + s.substring(1)).join(' ');
        }
        
        // Function to generate QR code
        function generateQRCode() {
            const companyName = "YOUR COMPANY"; // Replace with dynamic value if needed
            const upiId = "your-upi-id@okhdfcbank"; // Replace with your UPI ID
            const grandTotal = document.getElementById('grand-total').textContent;
            
            if(grandTotal && parseFloat(grandTotal) > 0) {
                const upiString = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(companyName)}&am=${grandTotal}&cu=INR`;
                document.getElementById('qrcode').innerHTML = ""; // Clear previous QR
                new QRCode(document.getElementById("qrcode"), {
                    text: upiString,
                    width: 128,
                    height: 128
                });
            }
        }
        
        let productNames = [];

        async function fetchAndPopulateProducts() {
            try {
                const response = await fetch('product_master.csv');
                const data = await response.text();
                const rows = data.split('\n').slice(1); // Skip header row
                const names = rows.map(row => row.split(',')[0].trim()).filter(name => name);
                productNames = [...new Set(names)]; // Get unique names
                
                // Populate initial dropdowns
                document.querySelectorAll('.particulars').forEach(populateParticulars);

            } catch (error) {
                console.error('Error fetching or parsing CSV:', error);
                showMessage('Could not load product list.', 'error');
            }
        }

        function populateParticulars(selectElement) {
            if (!selectElement) return;
            // Clear existing options except the first one
            while (selectElement.options.length > 1) {
                selectElement.remove(1);
            }
            // Add new options
            productNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                selectElement.appendChild(option);
            });
        }
        
        // Function to show a message to the user
        function showMessage(message, type = 'success') {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.style.backgroundColor = type === 'error' ? '#c0392b' : '#004343';
            box.style.display = 'block';
            setTimeout(() => {
                box.style.display = 'none';
            }, 3000);
        }

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            setCurrentDate();
            populateStates();
            addItem(); // Add one item row by default
            fetchAndPopulateProducts();
            
            // Attach event listeners for tax and discount inputs
            document.getElementById('discount-percent').addEventListener('input', updateCalculations);
            document.getElementById('cgst-percent').addEventListener('input', updateCalculations);
            document.getElementById('sgst-percent').addEventListener('input', updateCalculations);
            document.getElementById('igst-percent').addEventListener('input', updateCalculations);
            document.getElementById('tcs-percent').addEventListener('input', updateCalculations);
            
            // Initial calculation
            updateCalculations();
            
            // Generate QR code on load and on update
            generateQRCode();
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', generateQRCode);
            });
        });
    </script>
</body>
</html>
